<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debajit's Interactive 3D Website</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow-y: auto;
            overflow-x: hidden;
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            color: #ffffff;
            min-height: 200vh;
        }
        
        /* Main page container */
        #main-page {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            background-color: transparent;
        }
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            background: transparent;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.7s, transform 0.7s, filter 0.7s;
            opacity: 1;
            transform: scale(1);
            filter: blur(0px);
        }
        #loading-overlay.fade-out {
            opacity: 0;
            transform: scale(1.05);
            filter: blur(8px);
            pointer-events: none;
        }
        #three-container {
            opacity: 0;
            transition: opacity 2.2s cubic-bezier(.77,0,.18,1);
        }
        #three-container.fade-in {
            opacity: 1;
        }
        .loading-text {
            position: absolute;
            top: 20px;
            font-size: 1.5em;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(74, 85, 104, 0.9);
            color: #cbd5e0;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            animation: fadeInOut 4s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        /* Dive In Animation Enhancements */
        .zoom-blur {
            transform: scale(1.18);
            filter: blur(10px) brightness(0.5);
            transition: transform 1.2s cubic-bezier(.77,0,.18,1), filter 1.2s cubic-bezier(.77,0,.18,1);
        }
        .curtain {
            position: fixed;
            top: 0;
            width: 50vw;
            height: 100vh;
            background: linear-gradient(90deg, #181818 80%, #232323 100%);
            z-index: 2000;
            transition: transform 1.1s cubic-bezier(.77,0,.18,1);
        }
        .curtain.left {
            left: 0;
            transform: translateX(-100%);
        }
        .curtain.right {
            right: 0;
            background: linear-gradient(270deg, #181818 80%, #232323 100%);
            transform: translateX(100%);
        }
        .curtain.in.left {
            transform: translateX(0);
        }
        .curtain.in.right {
            transform: translateX(0);
        }
        .flash {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle at 50% 50%, #fff 0%, #fff8 40%, #0000 80%);
            opacity: 0;
            pointer-events: none;
            z-index: 3000;
            transition: opacity 0.35s cubic-bezier(.77,0,.18,1);
        }
        .flash.in {
            opacity: 1;
        }
        
        /* Room Section Styles */
        #room-section {
            position: relative;
            width: 100vw;
            height: 100vh;
            margin-top: 100vh;
            background: linear-gradient(135deg, #181818 0%, #232323 100%);
            overflow: hidden;
            opacity: 0;
            transform: translateY(100px);
            transition: opacity 1s ease-out, transform 1s ease-out;
            z-index: 5;
        }
        
        #room-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        #room-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: blue; /* Debug: make it visible */
        }
        
        /* Main content transitions */
        #main-content {
            transition: opacity 0.8s ease-out, pointer-events 0.8s ease-out;
        }
        
        #main-body {
            transition: filter 0.8s ease-out;
        }
        
        button {
            transition: opacity 0.8s ease-out, pointer-events 0.8s ease-out, transform 0.18s, box-shadow 0.18s, background 0.18s;
        }
        
        div[style*="color: #000000"] {
            transition: opacity 0.8s ease-out, pointer-events 0.8s ease-out;
        }
        
        #music-control {
            transition: opacity 0.8s ease-out, pointer-events 0.8s ease-out;
        }
        
        .room-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.8) 70%, rgba(0,0,0,1) 100%);
            opacity: 0;
            transition: opacity 0.8s ease-out;
            z-index: 10;
        }
        
        .room-overlay.active {
            opacity: 1;
        }
        
        .scroll-indicator {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffe066;
            font-size: 1.2em;
            font-weight: 500;
            text-align: center;
            z-index: 50;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .scroll-indicator.hidden {
            opacity: 0;
        }
        
        .scroll-arrow {
            display: block;
            font-size: 2em;
            margin-top: 10px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>
<body id="main-body" style="background: #000; margin: 0; min-height: 100vh;">
    <video id="bg-video" autoplay loop muted playsinline
      style="position: fixed; top: 0; left: 0; min-width: 100vw; min-height: 100vh; object-fit: cover; z-index: 0;">
      <source src="assets/bgvideo.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    
    <!-- Loading Overlay (moved outside main-content) -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; background: transparent; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.7s;">
        <div id="cat-gif-row" style="display: flex; flex-direction: row; justify-content: center; align-items: flex-end; gap: 32px; margin-bottom: 36px;">
            <img src="cat.gif" alt="Cat 1" style="max-width: 200px; max-height: 200px; border-radius: 16px;" />
            <img src="cat1.gif" alt="Cat 2" style="max-width: 140px; max-height: 140px; border-radius: 16px;" />
            <img src="cat2.gif" alt="Cat 3" style="max-width: 140px; max-height: 140px; border-radius: 16px;" />
        </div>
        <div id="loading-percent" style="font-family: 'Playfair Display', serif; font-size: 4.2em; color: #ffe066; font-weight: 700; letter-spacing: 0.08em; margin-top: 10px; text-shadow: 0 2px 16px #000a;">1%</div>
    </div>
    
    <!-- Main Content Container -->
    <div id="main-content" style="position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden;">
        <!-- Music Control Button -->
        <button id="music-control" style="position: fixed; top: 32px; left: 36px; width: 48px; height: 48px; background: rgba(0,0,0,0.18); border: none; border-radius: 50%; display: flex; justify-content: center; align-items: center; z-index: 25; cursor: pointer; transition: background 0.2s;">
            <svg id="music-icon" width="24" height="24" viewBox="0 0 24 24" style="stroke: #ffe066; stroke-width: 2; fill: none;">
                <path d="M9 18V5l12-2v13"/>
                <circle cx="6" cy="18" r="3"/>
                <circle cx="18" cy="16" r="3"/>
            </svg>
        </button>
        <!-- Scroll Indicator -->
        <div class="scroll-indicator">
            <span>Scroll to explore</span>
            <span class="scroll-arrow">↓</span>
        </div>
    </div>
    
    <!-- Room Section -->
    <div id="room-section">
        <div id="room-container">
            <!-- Test element to see if room container is visible -->
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 2em; z-index: 1000; background: red; padding: 20px;">
                ROOM CONTENT LOADED
            </div>
        </div>
        <div class="room-overlay"></div>
    </div>
    
    <!-- Background Music -->
    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script>
    // --- SCROLL-BASED TRANSITION VARIABLES ---
    let roomScene = null;
    let isRoomVisible = false;
    
    // Animate the loading percent
    function animatePercent(duration = 2200) {
        const percentEl = document.getElementById('loading-percent');
        if (!percentEl) return;
        let start = null;
        function step(ts) {
            if (!start) start = ts;
            const elapsed = ts - start;
            let percent = Math.min(100, Math.floor((elapsed / duration) * 100) + 1);
            percentEl.textContent = percent + '%';
            if (percent < 100) {
                requestAnimationFrame(step);
            } else {
                percentEl.textContent = '100%';
            }
        }
        requestAnimationFrame(step);
    }
    animatePercent();

    // --- Standardized Music Control ---
    const bgMusic = document.getElementById('bg-music');
    const musicControl = document.getElementById('music-control');
    const musicIcon = document.getElementById('music-icon');
    let musicPlaying = false;

    function startMusic() {
        const savedVolume = sessionStorage.getItem('musicVolume');
        if (savedVolume) {
            bgMusic.volume = parseFloat(savedVolume);
        } else {
            bgMusic.volume = 0.7; // Default volume
        }
        
        const wasPlaying = sessionStorage.getItem('musicPlaying') === 'true';
        // Play if returning from a page where music was on, or if it's the very first visit
        if (wasPlaying || sessionStorage.getItem('musicPlaying') === null) {
            bgMusic.play().then(() => {
                musicPlaying = true;
                sessionStorage.setItem('musicPlaying', 'true');
                updateMusicIcon();
            }).catch(error => {
                console.log('Music autoplay blocked:', error);
                musicPlaying = false;
                sessionStorage.setItem('musicPlaying', 'false'); // Set state to off if autoplay fails
                updateMusicIcon();
            });
        } else {
            musicPlaying = false;
            updateMusicIcon();
        }
    }

    function toggleMusic() {
        if (musicPlaying) {
            bgMusic.pause();
            musicPlaying = false;
            sessionStorage.setItem('musicPlaying', 'false');
        } else {
            bgMusic.play();
            musicPlaying = true;
            sessionStorage.setItem('musicPlaying', 'true');
        }
        updateMusicIcon();
    }

    function updateMusicIcon() {
        if (musicPlaying) {
            musicIcon.innerHTML = `
                <path d=\"M9 18V5l12-2v13\"/>
                <circle cx=\"6\" cy=\"18\" r=\"3\"/>
                <circle cx=\"18\" cy=\"16\" r=\"3\"/>
            `;
        } else {
            musicIcon.innerHTML = `
                <path d=\"M9 18V5l12-2v13\"/>
                <circle cx=\"6\" cy=\"18\" r=\"3\"/>
                <circle cx=\"18\" cy=\"16\" r=\"3\"/>
                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" stroke=\"#ffe066\" stroke-width=\"2\"/>
            `;
        }
    }
    
    musicControl.addEventListener('click', toggleMusic);
    musicControl.addEventListener('mouseenter', () => { musicControl.style.background = 'rgba(255,224,102,0.12)'; });
    musicControl.addEventListener('mouseleave', () => { musicControl.style.background = 'rgba(0,0,0,0.18)'; });

    // Initialize music state on page load
    startMusic();

    // Only show loading if not returning from room.html
    let skipLoading = false;
    if (window.sessionStorage.getItem('fromRoom') === '1') {
        skipLoading = true;
        window.sessionStorage.removeItem('fromRoom');
    }

    function fadeOutAndRemoveLoadingOverlay() {
        console.log('🔄 fadeOutAndRemoveLoadingOverlay called');
        const overlay = document.getElementById('loading-overlay');
        const three = document.getElementById('three-container');
        
        if (overlay) {
            console.log('🎭 Fading out loading overlay');
            overlay.classList.add('fade-out');
            
            if (three) {
                three.style.display = 'block';
                setTimeout(() => three.classList.add('fade-in'), 40);
            }
            
            // Force remove the overlay after transition
            setTimeout(() => {
                console.log('🗑️ Removing loading overlay');
                overlay.remove();
            }, 800);
        } else {
            console.log('⚠️ No loading overlay found');
            if (three) {
                three.style.display = 'block';
                setTimeout(() => three.classList.add('fade-in'), 40);
            }
        }
    }

    function renderMainScene() {
        console.log('🎬 renderMainScene called');
        
        // Create container for Three.js
        const container = document.createElement('div');
        container.id = 'three-container';
        container.style.position = 'fixed';
        container.style.top = '0';
        container.style.left = '0';
        container.style.width = '100vw';
        container.style.height = '100vh';
        container.style.zIndex = '2';

        // Add name above the subtitle
        const nameDiv = document.createElement('div');
        nameDiv.textContent = 'Debajit';
        nameDiv.style.position = 'fixed';
        nameDiv.style.top = '50%';
        nameDiv.style.left = '50%';
        nameDiv.style.transform = 'translate(-50%, -50%)';
        nameDiv.style.color = '#ffe066';
        nameDiv.style.fontSize = '3.2em';
        nameDiv.style.fontWeight = '900';
        nameDiv.style.letterSpacing = '0.04em';
        nameDiv.style.textShadow = '0 2px 32px #000a, 0 0 20px #ffe06688';
        nameDiv.style.zIndex = '11';
        nameDiv.style.fontFamily = 'Playfair Display, serif';
        nameDiv.style.pointerEvents = 'none';
        nameDiv.style.userSelect = 'none';
        
        // Add subtitle cycling text below the name
        const subtitles = [
            "software engineer",
            "Reinforcement learning", 
            "YNWA - Liverpool ❤️"
        ];
        const subtitleDiv = document.createElement('div');
        subtitleDiv.style.position = 'fixed';
        subtitleDiv.style.top = 'calc(50% + 3.2em)';
        subtitleDiv.style.left = '50%';
        subtitleDiv.style.transform = 'translate(-50%, 0)';
        subtitleDiv.style.color = '#000000';
        subtitleDiv.style.fontSize = '1.6em';
        subtitleDiv.style.fontWeight = '700';
        subtitleDiv.style.letterSpacing = '0.04em';
        subtitleDiv.style.textShadow = '0 2px 12px rgba(255, 255, 255, 0.9), 0 0 20px rgba(255, 255, 255, 0.6)';
        subtitleDiv.style.zIndex = '10';
        subtitleDiv.style.fontFamily = 'Inter, sans-serif';
        subtitleDiv.style.pointerEvents = 'none';
        subtitleDiv.style.opacity = '0';
        subtitleDiv.style.transition = 'opacity 1.7s';
        
        // Add both to main-content container
        const mainContent = document.getElementById('main-content');
        console.log('📦 Main content found:', !!mainContent);
        
        mainContent.appendChild(container);
        mainContent.appendChild(nameDiv);
        mainContent.appendChild(subtitleDiv);
        
        console.log('✅ Elements added to main-content');

        // Three.js setup
        const scene = new THREE.Scene();
        scene.background = null;
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 10);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Spheres random cluster (no overlap)
        const spheres = [];
        const sphereCount = 35;
        const minGap = 0.08; // minimum gap between spheres
        for (let i = 0; i < sphereCount; i++) {
            let tries = 0;
            let pos, s;
            let valid = false;
            while (!valid && tries < 120) {
                // Random position in a slightly smaller sphere
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                const r = 1.7 + Math.random() * 2;
                const x = Math.sin(phi) * Math.cos(theta) * r;
                const y = Math.sin(phi) * Math.sin(theta) * r * 0.9;
                const z = Math.cos(phi) * r * 0.7;
                s = 0.38 + Math.random() * 0.55;
                pos = new THREE.Vector3(x, y, z);
                valid = true;
                for (let j = 0; j < spheres.length; j++) {
                    const other = spheres[j];
                    const minDist = (other.geometry.parameters.radius + s) + minGap;
                    if (
                        pos.distanceTo(other.position) < minDist ||
                        Math.abs(pos.x - other.position.x) < minDist ||
                        Math.abs(pos.y - other.position.y) < minDist ||
                        Math.abs(pos.z - other.position.z) < minDist
                    ) {
                        valid = false;
                        break;
                    }
                }
                tries++;
            }
            const geometry = new THREE.SphereGeometry(s, 48, 48);
            const material = new THREE.MeshPhysicalMaterial({
                color: 0xf8f6ff,
                metalness: 0.45,
                roughness: 0.18,
                reflectivity: 0.7,
                clearcoat: 0.18,
                clearcoatRoughness: 0.18,
                transmission: 0.22,
                ior: 1.6,
                envMapIntensity: 1.1,
                sheen: 1.0,
                sheenColor: new THREE.Color(0xc7e0ff),
                sheenRoughness: 0.18,
                iridescence: 0.45,
                iridescenceIOR: 1.3,
                iridescenceThicknessRange: [120, 340],
            });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.copy(pos);
            sphere.userData.home = sphere.position.clone();
            scene.add(sphere);
            spheres.push(sphere);
        }

        // Lighting
        const ambient = new THREE.AmbientLight(0xffffff, 0.38);
        scene.add(ambient);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(3, 6, 8);
        scene.add(dirLight);
        const pointLight = new THREE.PointLight(0xffffff, 1.2, 100);
        pointLight.position.set(-4, 4, 8);
        scene.add(pointLight);

        // Mouse interaction
        let mouse = new THREE.Vector2(0, 0);
        let mouseWorld = new THREE.Vector3(0, 0, 0);
        let raycaster = new THREE.Raycaster();
        window.addEventListener('mousemove', (event) => {
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const t = -raycaster.ray.origin.z / raycaster.ray.direction.z;
            mouseWorld = raycaster.ray.origin.clone().add(raycaster.ray.direction.clone().multiplyScalar(t));
        });

        // Animate spheres with repulsion
        function animateSpheres() {
            requestAnimationFrame(animateSpheres);
            spheres.forEach((sphere, i) => {
                const dist = sphere.position.distanceTo(mouseWorld);
                const home = sphere.userData.home;
                let repulse = new THREE.Vector3();
                if (dist < 2.2) {
                    const strength = 1.5 * Math.pow(2.2 - dist, 1.25);
                    repulse.copy(sphere.position).sub(mouseWorld).normalize().multiplyScalar(strength);
                }
                const toHome = home.clone().sub(sphere.position).multiplyScalar(0.11);
                sphere.position.add(toHome).add(repulse.multiplyScalar(0.32));
                sphere.rotation.y += 0.01 + i * 0.002;
            });

            for (let i = 0; i < spheres.length; i++) {
                for (let j = i + 1; j < spheres.length; j++) {
                    const a = spheres[i];
                    const b = spheres[j];
                    const ra = a.geometry.parameters.radius;
                    const rb = b.geometry.parameters.radius;
                    const minDist = ra + rb + minGap;
                    const delta = b.position.clone().sub(a.position);
                    const d = delta.length();
                    if (d < minDist && d > 0.0001) {
                        const overlap = (minDist - d) / 2;
                        const push = delta.normalize().multiplyScalar(overlap + 0.001);
                        b.position.add(push);
                        a.position.add(push.clone().multiplyScalar(-1));
                    }
                }
            }
            renderer.render(scene, camera);
        }
        animateSpheres();

        // Responsive
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Subtitle cycling logic
        let subtitleIdx = 0;
        function cycleSubtitle() {
            subtitleDiv.textContent = subtitles[subtitleIdx];
            subtitleDiv.style.opacity = '1';
            setTimeout(() => {
                subtitleDiv.style.opacity = '0';
                setTimeout(() => {
                    subtitleIdx = (subtitleIdx + 1) % subtitles.length;
                    cycleSubtitle();
                }, 600); // fade out duration
            }, 1800); // visible duration
        }
        setTimeout(cycleSubtitle, 600); // initial delay

        fadeOutAndRemoveLoadingOverlay();
    }

    // Call showMainScene or loading logic
    if (skipLoading) {
        console.log('⏭️ Skipping loading, calling fadeOutAndRemoveLoadingOverlay and renderMainScene');
        fadeOutAndRemoveLoadingOverlay();
        renderMainScene();
    } else {
        console.log('⏳ Loading enabled, will call renderMainScene in 1.2s');
        setTimeout(() => {
            console.log('⏰ Timeout finished, calling renderMainScene');
            renderMainScene();
        }, 1200);
    }
    
    // --- SCROLL-BASED TRANSITION ---
    
    function initRoomScene() {
        const roomContainer = document.getElementById('room-container');
        if (!roomContainer || roomScene) {
            console.log('🚫 Room scene already loaded or container not found');
            return;
        }
        
        console.log('🔄 Loading room.html content...');
        
        // Load room.html content directly
        fetch('room.html')
            .then(response => {
                console.log('📡 Response status:', response.status);
                return response.text();
            })
            .then(html => {
                console.log('📄 Room.html content fetched, length:', html.length);
                
                // Create a temporary div to parse the HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                
                // Extract the body content from room.html
                const roomBody = tempDiv.querySelector('body');
                if (roomBody) {
                    console.log('✅ Room body content found');
                    
                    // Remove the body tag but keep its contents
                    const roomContent = document.createElement('div');
                    roomContent.innerHTML = roomBody.innerHTML;
                    roomContent.style.width = '100%';
                    roomContent.style.height = '100%';
                    roomContent.style.position = 'absolute';
                    roomContent.style.top = '0';
                    roomContent.style.left = '0';
                    roomContent.style.zIndex = '1';
                    
                    // Add room.html styles
                    const roomStyles = tempDiv.querySelector('style');
                    if (roomStyles) {
                        const styleSheet = document.createElement('style');
                        styleSheet.textContent = roomStyles.textContent;
                        document.head.appendChild(styleSheet);
                        console.log('🎨 Room styles added');
                    }
                    
                    roomContainer.appendChild(roomContent);
                    console.log('📦 Room content added to container');
                    
                    // Execute room.html scripts
                    const roomScripts = tempDiv.querySelectorAll('script');
                    roomScripts.forEach(script => {
                        if (script.src) {
                            // External script
                            const newScript = document.createElement('script');
                            newScript.src = script.src;
                            document.head.appendChild(newScript);
                        } else {
                            // Inline script
                            const newScript = document.createElement('script');
                            newScript.textContent = script.textContent;
                            document.head.appendChild(newScript);
                        }
                    });
                    console.log('📜 Room scripts executed');
                } else {
                    console.log('❌ Room body content not found');
                }
            })
            .catch(error => {
                console.error('❌ Error loading room.html:', error);
            });
        
        roomScene = { loaded: true };
        console.log('✅ Room scene initialized');
    }
    
    // Scroll event handler
    function handleScroll() {
        const scrollY = window.scrollY;
        const windowHeight = window.innerHeight;
        const scrollThreshold = windowHeight * 0.1; // Lower threshold to 10% of viewport height
        
        const roomSection = document.getElementById('room-section');
        const mainContent = document.getElementById('main-content');
        
        if (scrollY > scrollThreshold) {
            if (!isRoomVisible) {
                isRoomVisible = true;
                roomSection.classList.add('visible');
                
                // Completely hide main content (like loading transition)
                if (mainContent) {
                    mainContent.style.opacity = '0';
                    mainContent.style.pointerEvents = 'none';
                    mainContent.style.transform = 'scale(1.05)';
                    mainContent.style.filter = 'blur(8px)';
                }
                
                // Load room.html content
                initRoomScene();
                
                // Add overlay effect
                setTimeout(() => {
                    const overlay = document.querySelector('.room-overlay');
                    overlay.classList.add('active');
                }, 500);
            }
        } else {
            if (isRoomVisible) {
                isRoomVisible = false;
                roomSection.classList.remove('visible');
                
                // Show main content again
                if (mainContent) {
                    mainContent.style.opacity = '1';
                    mainContent.style.pointerEvents = 'auto';
                    mainContent.style.transform = 'scale(1)';
                    mainContent.style.filter = 'blur(0px)';
                }
                
                const overlay = document.querySelector('.room-overlay');
                overlay.classList.remove('active');
            }
        }
    }
    
    // Add scroll event listener
    window.addEventListener('scroll', handleScroll);
    
    // Handle window resize
    window.addEventListener('resize', () => {
        // Iframe will handle its own resizing
    });
    
    // --- DIVE IN BUTTON ---
    const diveBtn = document.createElement('button');
    diveBtn.textContent = 'Dive In';
    diveBtn.style.position = 'fixed';
    diveBtn.style.top = 'calc(50% + 7.2em)';
    diveBtn.style.left = '50%';
    diveBtn.style.transform = 'translate(-50%, 0)';
    diveBtn.style.background = 'linear-gradient(90deg, #c0c0c0 60%, #e8e8e8 100%)';
    diveBtn.style.color = '#333';
    diveBtn.style.fontFamily = 'Gateway, Inter, sans-serif';
    diveBtn.style.fontWeight = 'bold';
    diveBtn.style.fontSize = '2.2em';
    diveBtn.style.letterSpacing = '0.08em';
    diveBtn.style.padding = '0.6em 2.2em';
    diveBtn.style.border = 'none';
    diveBtn.style.borderRadius = '1.6em';
    diveBtn.style.boxShadow = '0 8px 48px #c0c0c044, 0 2px 8px #0002';
    diveBtn.style.cursor = 'pointer';
    diveBtn.style.zIndex = '12';
    diveBtn.style.transition = 'transform 0.18s, box-shadow 0.18s, background 0.18s';
    diveBtn.onmouseenter = () => {
        diveBtn.style.transform = 'translate(-50%, 0) scale(1.06)';
        diveBtn.style.boxShadow = '0 12px 64px #c0c0c077, 0 2px 8px #0002';
    };
    diveBtn.onmouseleave = () => {
        diveBtn.style.transform = 'translate(-50%, 0) scale(1)';
        diveBtn.style.boxShadow = '0 8px 48px #c0c0c044, 0 2px 8px #0002';
    };
    
    // Add dive button to main-content container instead of body
    const mainContent = document.getElementById('main-content');
    mainContent.appendChild(diveBtn);

    // --- DIVE IN TRANSITION ---
    // Add curtains and flash elements to main-content as well
    const curtainLeft = document.createElement('div');
    curtainLeft.className = 'curtain left';
    mainContent.appendChild(curtainLeft);
    const curtainRight = document.createElement('div');
    curtainRight.className = 'curtain right';
    mainContent.appendChild(curtainRight);
    const flash = document.createElement('div');
    flash.className = 'flash';
    mainContent.appendChild(flash);

    diveBtn.onclick = () => {
        sessionStorage.setItem('musicPlaying', musicPlaying ? 'true' : 'false');
        sessionStorage.setItem('musicVolume', bgMusic.volume.toString());

        const bgVideo = document.getElementById('bg-video');
        if (bgVideo) {
            bgVideo.play().then(() => {
                setTimeout(() => {
                    bgVideo.playbackRate = 15;
                }, 200);
            });
        }

        setTimeout(() => {
            document.body.classList.add('zoom-blur');
            if (bgVideo) bgVideo.classList.add('zoom-blur');
            if (document.getElementById('main-content')) document.getElementById('main-content').classList.add('zoom-blur');
            if (document.getElementById('main-body')) document.getElementById('main-body').classList.add('zoom-blur');

            setTimeout(() => {
                curtainLeft.classList.add('in');
                curtainRight.classList.add('in');
            }, 300);
            setTimeout(() => {
                flash.classList.add('in');
            }, 600);
            setTimeout(() => {
                if (bgVideo) bgVideo.playbackRate = 1;
                window.location.href = 'room.html';
            }, 1000);
        }, 200);
    };
    
    </script>
</body>
</html>